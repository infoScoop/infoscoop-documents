# OAuth管理

OAuth及びOAuth関連仕様についての設定及び管理方法について説明します。

## 1 OAuthとは

OAuthとは、マッシュアップを行いたいサービス(コンシューマ)が、ユーザーのidやパスワードを直接受け取ることなく、マッシュアップ元のサービス(サービスプ
ロバイダー)で認証させ、必要なデータの取得を可能にする仕様のことです。

infoScoop OpenSourceはコンシューマにあたります。

またOAuthに関連したものとして、OpenSocialの仕様である署名付きリクエストにもinfoScoop OpenSourceは対応しています。

infoScoop OpenSourceのOAuth設定は、OAuth及び署名付きリクエストを利用したガジェットをinfoScoop
OpenSource上で使用する場合に必要となります。

これらのガジェットを使用する場合は、本ページの内容を参考にして必要な各設定を行ってください。

## 2 OAuth設定手段と対応する管理画面

infoScoop OpenSource上でOAuthガジェットを利用するためには、以下の2種類の方法があります。

  1. infoScoop OpenSourceにOAuth対応ガジェットをアップロードする
  2. 外部サーバーに配置してあるOAuth対応ガジェットを使用する

OAuthガジェットの情報の登録は、infoScoop OpenSource管理画面の[**OAuth**]管理画面より行います。

以下、[**OAuth**]管理画面の詳細について説明していきます。

## 3 OAuth管理画面

OAuth管理画面は、管理画面上部のメニューより[**OAuth**]をクリックして開きます。

ここではOAuth及び署名付きリクエストについての設定を行うことができます。

OAuth管理画面は、[**コンシューマー設定**]タブと[**コンテナの証明書**]タブから構成されています。

この項では、[コ**ンシューマー設定**]タブ、[**コンテナの証明書**]タブについて説明します。

### 3.1 コンシューマー設定

OAuthガジェットを使用するためには、[**コンシューマー設定**]タブで該当ガジェットの設定を追加する必要があります。

#### 3.1.1 コンテキストメニュー

[**OAuth**]管理画面のコンテキストメニューについて説明します。

<table>
    <thead>
        <tr>
            <th>アイコン</th>
            <th>名前</th>
            <th>説明</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><img src="../../images/add_menu_tree.gif"></td>
            <td>追加</td>
            <td>OAuthコンシューマー設定を追加します。</td>
        </tr>
        <tr>
            <td><img src="../../images/apply_changes.gif"></td>
            <td>変更を適用する</td>
            <td>クリックすると今までに行った編集操作（コンシューマー設定の追加、編集、削除）を適用（データを保存）します。<br/>
<b>注意</b> 最終的にこのアイコンをクリックしないと、編集操作は破棄されます。</td>
        </tr>
        <tr>
            <td><img src="../../images/refresh.gif"></td>
            <td>読み直し</td>
            <td>前回変更を適用した状態を表示します。</td>
        </tr>
     </tbody>
</table>

#### 3.1.2 設定項目の追加

[**コンシューマー設定**]タブの左上の[![Add icon]**追加**]ボタンを押すことで、ガジェットのOAuth設定を追加することができます。

[![Add icon]**追加**]ボタンをクリックすると詳細を入力するためのモーダル画面が表示されます。

![Consumer Settings]

#### 3.1.3 [コンシューマー設定]における設定項目

[**コンシューマー設定**]タブの追加モーダル画面における設定項目の入力内容は、以下の表を参考にしてください。

<table>
    <thead>
    <tr>
        <th colspan="2">設定項目</th>
        <th>説明</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td colspan="2">サービス名</td>
        <td>ガジェットのサービス名を入力します。<br/>
        ガジェットのサービス名は、ガジェットの本体であるxmlファイルの中に記述されています。<br/>
        Module/ModulePrefs/OAuth/Serviceのname属性の値がサービス名です。</td>
    </tr>
    <tr>
        <td colspan="2">OAuthバージョン</td>
        <td>OAuthのバージョンを選択します。
            <ul>
                <li>1.0</li>
                <li>2.0</li>
            </ul>
        </td>
    </tr>
    <tr>
        <td rowspan="3">1.0</td>
        <td>署名アルゴリズム</td>
        <td>サービスプロバイダーに従い、署名アルゴリズムを以下の2つから選択します。<br>
            <ul>
                <li>HMAC-SHA1</li>
                <li>RSA-SHA1</li>
            </ul>
        </td>
    </tr>
    <tr>
        <td>コンシューマーキー</td>
        <td>HMAC-SHA1を選択した場合、サービスプロバイダーから取得したコンシューマーキーを入力します。</td>
    </tr>
    <tr>
        <td>コンシューマーシークレット</td>
        <td>HMAC-SHA1を選択した場合、サービスプロバイダーから取得したコンシューマーシークレットを入力します。</td>
    </tr>
    <tr>
        <td rowspan="2">2.0</td>
        <td>クライアントID</td>
        <td>サービスプロバイダーから取得したクライアントIDを入力します。</td>
    </tr>
    <tr>
        <td>クライアントシークレット</td>
        <td>サービスプロバイダーから取得したクライアントシークレットを入力します。</td>
    </tr>
    <tr>
        <td colspan="2">説明</td>
        <td>コンシューマー設定の説明を入力します。（任意）</td>
    </tr>
    <tr>
        <td colspan="2">ガジェットの追加</td>
        <td>コンシューマー設定を使用するガジェットを追加します。<br/>
        ガジェットはURLを指定するか、アップロードされたガジェットから選択することで追加できます。
        </td>
    </tr>
    <tr>
        <td rowspan="2"></td>
        <td>ガジェット（URL指定）</td>
        <td>ガジェットのURLを入力します。<br/>
        例： http://www.infoscoop.org/gadgets/hello.xml
        </td>
    </tr>
    <tr>
        <td>アップロードガジェット</td>
        <td>アップロードされたガジェットを選択します。<br/>
        ガジェットは[<b>ガジェット</b>]管理画面からアップロードできます。
        </td>
	</tr>
    </tbody>
</table>

<a name="container_cert"></a>
### 3.2 コンテナの証明書

**RSA-SHA1**形式を利用するOAuthガジェット、及び**署名付きリクエスト**を利用するには、[**コンテナの証明書**]タブでの設定が必要です。

ここで設定した証明書はサービスプロバイダーへのリクエストに付加する署名の作成、および、サービスプロバイダーが受け取った署名を検証するために使用します。

したがって、コンシューマーキーおよび公開鍵はサービスプロバイダーに提供する必要があります。

ただし、誰にも公開しないように注意してください。

また、コンシューマーキー、秘密鍵及び公開鍵は初期状態でサンプルが設定されていますが、必ず変更してください。

原則としてこれら3つの設定項目は設定後変更しないようにしてください。

上記の通りコンシューマーキーと公開鍵はサービスプロバイダーに提供するため、提供後にそれらを変更するとサービスが使用できなくなる恐れがあるためです。

#### 3.2.1 コンテキストメニュー

[OAuth]管理画面のコンテキストメニューについて説明します。

<table>
    <thead>
        <tr>
            <th>アイコン</th>
            <th>名前</th>
            <th>説明</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><img src="../../images/apply_changes.gif"></td>
            <td>変更を適用する</td>
            <td>クリックすると今までに行った編集操作（コンシューマーキー、秘密鍵、公開鍵の変更）を適用（データを保存）します。<br/>
            <b>注意</b> 最終的にこのアイコンをクリックしないと、編集操作は破棄されます。
            </td>
        </tr>
        <tr>
            <td><img src="../../images/refresh.gif"></td>
            <td>読み直し</td>
            <td>前回変更を適用した状態を表示します。</td>
        </tr>
     </tbody>
</table>

#### 3.2.2 [コンテナの証明書]における設定項目

[**コンテナの証明書**]タブにおける設定項目については、以下の表を参考にしてください。

<table>
    <thead>
        <tr>
            <th>設定項目</th>
            <th>設定項目の説明</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>コンシューマーキー</td>
            <td>コンテナを一意に識別するための任意の文字列を指定します。<br/>
            署名付きリクエストやOAuthに対応するサービスプロバイダーに設定したコンシューマーキーを知らせてください。</td>
        </tr>
        <tr>
            <td>秘密鍵</td>
            <td>PEM形式のパスフレーズなしのRSA秘密鍵を指定します。<br/>
            秘密鍵は誰にも公開しないように注意してください。
            </td>
        </tr>
        <tr>
            <td>公開鍵</td>
            <td>PEM形式のRSA公開鍵を指定します。<br/>
            設定した公開鍵は以下のURLから取得できます。<br/>
            http://localhost:8080/infoscoop/opensocial/certificates/public.cer<br/>
            </td>
        </tr>
     </tbody>
</table>

## 4 OAuthコールバックURLについて

OAuthサービスプロバイダにOAuthコンシューマキー、コンシューマシークレットを要求する場合、OAuthコールバックURLの提示を要求されることがありま
す。コールバックURLは以下を指定することができます。

  * OAuth 1.0: `http://<ホスト名>:＜ポート番号＞/infoscoop/oauthcallback`
  * OAuth 2.0: `http://<ホスト名>:＜ポート番号＞/infoscoop/oauth2callback`


[Add icon]: ../../images/add_menu_tree.gif "追加"
[Consumer Settings]: images/oauth/oauth-administration.png
