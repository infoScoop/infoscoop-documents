# 菜单管理

关于菜单的构成及各菜单项目的设定方法进行说明。


## 1 菜单

infoScoop OpenSource把内部网站及外部网站作为被阶层化的菜单进行管理。
菜单，有在界面上部被表示的顶部菜单和界面左侧的标签中包含的侧面菜单。
菜单除了有作为链接集和RSS阅读器的代表功能以外，还有选择各种小工具的功能。
菜单的管理有专用的管理画面，能执行菜单项目的追加，编辑，删除，变更顺序。
同时，可以为菜单树指定外部服务。


## 2 菜单管理界面

点击管理画面上部的[菜单]，可以打开菜单管理画面。
菜单管理界面可以用类似于资源管理器的操作来进行菜单的管理。


## 3 菜单的选择

在infoScoop OpenSource的菜单里，有__顶部菜单__和__侧面菜单__的2个阶层式菜单。
从菜单管理画面左侧的侧栏上可以选择要参照或要编辑的菜单。
顶部菜单和侧面菜单的构成，能选择是不是一样或者不同的构成。
可以设定顶部菜单和侧面菜单的构成是一样或是不同。在「displaySideMenu」属性指定中可以完成此设定。

关于属性的设定方法，请参照[属性管理][Properties Settings]。
如果把顶部菜单和侧面菜单设定成同样的构成，当选择侧面菜单时，会显示「参照和顶部菜单相同的菜单URL」的消息并且侧面菜单在编辑无效状态下被表示。


## 4 context菜单

关于菜单管理界面的context菜单进行说明。

<table>
    <thead>
        <tr>
            <th>图标</th><th>名称</th><th>说明</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><img src="../../images/open_all.gif"></td>
            <td>全部展开</td>
            <td>
                表示全部的菜单
            </td>
        </tr>
        <tr>
            <td><img src="../../images/close_all.gif"></td>
            <td>全部关闭</td>
            <td>
                关闭全部的菜单
            </td>
        </tr>
        <tr>
            <td><img src="../../images/add_menu_tree.gif"></td>
            <td>菜单树的追加/顺序变更</td>
            <td>
                点击后可以变更顶部菜单的顺序，以及追加新的菜单树。<br>
                这个图标只有拥有「菜单」权限的管理员用户才可以使用。
            </td>
        </tr>
        <tr>
            <td><img src="../../images/add_menu_tree.gif"></td>
            <td>追加菜单树</td>
            <td>
                追加新的菜单树<br>
                点击的话，菜单设定的对话框被表示。<br>
                这个图标只有在树的追加/移动模式的时候才可以使用。<br>
                各个设定内容请参照<a href="#menu_item_add_change">7 菜单项目的追加·变更</a>
            </td>
        </tr>
        <tr>
            <td><img src="../../images/refresh.gif"></td>
            <td>再读</td>
            <td>
                表示上回变更的状态。<br>
                关闭展开的菜单，只是表示菜单树。
            </td>
        </tr>
        <tr>
            <td></img src="../../images/refresh.gif"></td>
            <td>全部解锁</td>
            <td>
                解除全部的根菜单，顺序变更的锁，表示上回适用的状态。<br>
                关闭展开的菜单，只是表示菜单树。<br>
                这个图标只有在树编辑模式的时候才可以使用。
            </td>
        </tr>
        <tr>
            <td><img src="../../images/apply_changes.gif"></td>
            <td>适用变更</td>
            <td>
                单击后，应用(保存数据)到现在为止的编辑操作(追加/编辑/删除/移动)。<br>
                这个图标只有在树编辑模式的时候才可以使用。<br>
                <b>注意</b> 最后不单击这个图标的话，编辑操作被废弃。
            </td>
        </tr>
        <tr>
            <td><img src="../../images/preview.gif"></td>
            <td>整体预览</td>
            <td>
               现在被适用的构成信息在别的窗口表示。<br>
               这个图标只有拥有「菜单」权限的管理员用户才可以使用。
            </td>
        </tr>
    </tbody>
</table>


## 5 关于编辑模式和锁

因为在菜单管理方面有复数的用户同时进行操作的考虑，所以对各个操作分配了__参照模式__，__编辑模式__，__菜单树的追加/顺序变更模式__。
编辑模式，菜单树的追加/顺序变更模式，有各自独立的锁机构。


## 5.1 参照模式

参照模式是菜单管理画面表示时的初始状态。
右击根菜单标题的话，被表示的菜单项目设定用选项如下。

* [上锁后编辑]：取得菜单树的锁，把菜单树变为编辑模式。
* [参照]：表示菜单参照对话框。

单击「上锁后编辑」单击时，菜单树变成编辑模式。
「上锁后编辑」，只在根菜单被表示。
同时，通过点击菜单项目左面[+][-]图标能开关菜单。


## 5.2 编辑模式

通过对参照模式的菜单树进行「上锁后编辑」操作，取得菜单树的锁并把菜单树转换成编辑模式。
右击菜单标题的话，菜单项目设定用的菜单被表示。

* [__编辑__]:表示菜单编辑对话框。
* [__删除__]:表示菜单删除对话框。
* [__追加__]:表示菜单追加对话框。

处于上锁状态的的菜单树的标题颜色变为蓝色。
锁以树单位被进行。也可以锁上复数的树。


## 5.3 菜单树的追加/顺序变更模式

通过点击context菜单「菜单树的追加/顺序变更」，转换到菜单树的追加/顺序变更模式。
在菜单树的追加/顺序变换模式中，只有菜单树的顺序信息被锁上。
转换到菜单树的追加/顺序变更模式后，通过单击context菜单「追加菜单树」，可以追加新菜单树。
另外，拖动根菜单，能够变更菜单树的顺序。


## 5.4 配置控制

在编辑方式，菜单树的追加/顺序变更模式，为了防止和其他的用户的编辑冲突，取得锁之后进行编辑。
如果其他用户在对菜单树编辑当中(锁上状态)的菜单树进行「锁上编辑」，或其他用户进行菜单树顺序变更的状态进行了「菜单树的追加/顺序变更」时，其他的用户编辑中的对话框被表示。
对「如果继续执行处理，上述用户的编辑的编写内容将被废弃」的消息选择[OK]的话，在对话框上被表示的用户的编辑数据(单击「适用变更」之前的状态)被废弃。编辑数据被废弃了的用户，此后进行编辑的话，全部成为错误。

**注意** 可以强制性地取得锁的只有拥有包含管理权限菜单角色的管理员。不包含管理权限的角色被设定的管理员直到锁解除前不能编辑。

上锁状态时，编辑中的用户进行了以下的动作时锁会被解除。

* 解除全部的锁的时候
* 选择其他的管理菜单的时候
* 管理画面向其他的网址移动的时候
* 关闭浏览器的时候

同时，上锁会有超时的情况。最后一次编辑后经过30分钟后全部的锁会被解除。

**注意** 超时的时候，没进行「适用变更」的编辑内容全部被丢失。

超时时间用「menuLockTimeout」属性可以编辑。
关于属性的设定方法，请参照『属性管理』。


## 6 菜单项目的移动

菜单和菜单树，可以通过拖放使它们各自移动。


### 6.1 菜单的移动

这个操作在编辑模式时候可以使用。
单击鼠标，在横向一条虚线被表示的任何地方放开后，菜单会被移动到那个位置。
另外，与其他菜单重叠放置时，那个菜单的一周会出现虚线。拖放至虚线表示的任意的位置后，会移动到重叠了的菜单的子菜单上。


### 6.2 菜单树的移动

这个操作在菜单树的追加/顺序变更模式时可以使用。
通过单击「菜单树的追加/顺序变更」，可以移动菜单树。单击鼠标，在横向一条虚线被表示的任何地方放开后，菜单树会被移动到那个位置。
菜单树不能进行追加移动。


<a name="menu_item_add_change"></a>
## 7 菜单项目的追加·变更

编辑模式的时候，在各菜单的右击菜单中选择[__追加__]后，菜单设定对话框被表示。
设定项目如下。

* 菜单链接/小工具首部设定
* 小工具设定
* 公开设定
* 警报设定

同时，树追加/顺序变更方式的时候，单击内容[__追加菜单树__]的话，菜单树用的菜单设定对话框被表示。
设定项目如下。

* 菜单链接设定"
* 管理员设定
* 公开设定
* 警报设定

以下是关于各设定项目的详细。


### 7.1 菜单链接/小工具头设定

在这里，设定菜单项目的标题和标题附带的链接。如果对菜单设定小工具的话，这个设定被适用追加了的小工具头标题。

<table>
    <thead>
        <tr>
            <th>设定项目</th><th>说明</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>标题</td>
            <td>
                菜单的标题。必须。<br>
                标题最大可以输入80文字。
            </td>
        </tr>
        <tr>
            <td>标题链接</td>
            <td>
                菜单标题所附带的链接的URL。<br>
                URL最大可以输入1024字节。
            </td>
        </tr>
        <tr>
            <td>链接表示设定</td>
            <td>
                设定标题链接的表示目标。<br>
                [自动识别]:根据属性displayInlineHost的设定，门户内框架或新的窗被适用。参照:『displayInlineHost』<br>
                [门户内框架]:在门户内框架里表示链接目标。<br>
                [新窗口]:在另外的窗口表示链接目标。
            </td>
        </tr>
        <tr>
            <td>菜单不附带链接</td>
            <td>
                只有在小工具设定时有效。<br>
                菜单中不表示链接，被设定的小工具被追加的时候，小工具首部上附带被设定的标题链接。
            </td>
        </tr>
        <tr>
            <td>外部服务URL</td>
            <td>
                从外部服务器取得菜单设定时候的URL。<br>
                只可以设定在context菜单的[追加菜单树]上表示的对话框或者在被设定了外部服务菜单的菜单树的根目录。<br>
                参照：<a href="#specify_external_service">10. 指定外部服务</a>
            </td>
        </tr>
        <tr>
            <td>外部服务认证类型</td>
            <td>
                如果在指定了外部服务URL时，能为外部服务指定传给门户的登录用户ID的方法。<br>
                <b>没有</b>：登录用户的信息不被发送。<br>
                <b>postPortalCredential</b>：RSS取得时候，POST门户登录的用户ID。选择postPortalCredential的话，指定为POST数据包含的用户ID的参数名的文本框被表示。不指定参数名的时候，用户ID的参数名成为「is-user」。<br>
                <b>sendPortalCredentialHeader</b>：RSS取得的时对header发送门户登录做的用户ID。选择sendPortalCredentailHeader的话，指定发送用户 ID的头名的文本框被表示。不指定参数名的时候，用户ID的头名成为「is-user」。
            </td>
        </tr>
    </tbody>
</table>


### 7.2 小工具设定

在这里，设定有关菜单项目的小工具。
菜单上可以设定小工具如下。

* 日历
* RSS阅读器
* 复合RSS阅读器
* 迷你浏览器
* 截取HTML迷你浏览器
* Gadget(URL指定)
* TODO列表
* 警报
* 计算器
* 热门小工具
* 信息
* 博客的零部件
* 便签
* 世界时钟
* Gadget(在小工具管理上追加了的Gadget)

选择[**小工具种类**]的话，所选小工具相对应的设定项目被表示。
菜单管理的小工具设定上可以设定的项目是小工具的设定中/Module/UserPref的初始值。
同时，这个对话框，也能指定UserPref的datatype属性「hidden」的UserPref的初始值。

**注意** 一旦选定小工具的种类后不能变更。

关于各小工具的设定项目请参照各小工具设定的说明。
在这里，只对在菜单设定对话框里被表示的设定进行说明。


#### 7.2.1 对标题设定小工具的信息

RSS阅读器和迷你浏览器从被指定了的URL取得信息表示,不过在选择这样的小工具的时候，在指定URL的文本框的右侧会显示[__获取标题信息__]按钮。
单击[获取标题信息]按钮后，从被指定了的URL取得信息然后设定标题链接。
像TODO列表和警报一样不从外部取得信息的小工具，或像日历小工具一样小工具和URL不是以一对一指定的小工具的场合，把菜单项目的标题作为小工具的标题设定的[设定为标题信息]按钮被表示。
单击[设定为标题信息]按钮的话，标题被输入小工具种类。


#### 7.2.2 使复数拖放成为可能

在小工具设定上选择小工具的话，有些小工具会显示[**可以多个拖放**]按钮。
那是因为在菜单项目被设定的小工具有可以从用户自定义领域上复数追加和只能被追加一次的区别。

**注意** 「RSS阅读器」，「复合RSS阅读器」，「迷你浏览器」，「截取HTML迷你浏览器」的[可以多个拖放]复选框不被表示。Gadget的场 合，ModulePrefs的singleton属性false的时候[可以多个拖放]被表示、true的时候况成为非表示。

[**使复数拖放成为可能**]设定项目

<table>
    <thead>
        <tr>
            <th>设定项目</th><th>说明</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>可以多个拖放</td>
            <td>
                指定从菜单可否复数追加到自定义领域。
                <ul>
                    <li>有效：可以复数追加小工具。</li>
                    <li>无效：只能追加一个小工具。</li>
                </ul>
            </td>
        </tr>
    </tbody>
</table>


#### 7.2.3 预览

输入各个设定项目的必须项目后，单击[预览]按钮，设定了内容的小工具的预览被表示。


#### 7.2.4 还原到默认

在小工具设定项目下部，[__返还到默认值__]按钮被表示。各设定项目返还到默认。缺省值使用小工具管理被设定了的值。


### 7.3 菜单管理固有的小工具设定

在菜单的小工具设定中，根据所选小工具的不同，有特别值得一提的设定。


#### 7.3.1 复合RSS阅读器

复合RSS阅读器的设定项目与RSS阅读器是一样的。
与RSS阅读器有差异的点是，复合RSS阅读器在菜单被追加到自定义领域时候，设定了的父菜单作为复合RSS阅读器成为被设定的RSS阅读器。
例如，象以下一样的菜单树被设定。

* 父菜单：@IT网站
    * 子菜单：News（复合RSS阅读器）

这种把子菜单「News」拖到个性化领域上的情况下，作为它的父菜单「@IT网站」的子RSS阅读器被表示。


#### 7.3.2 Gadget(URL指定)

如果对菜单直接指定在网站服务器上配置的Gadget文件的时候，选择[__Gadget(URL指定)__]。
在小工具种类上选择[Gadget(URL指定)]的话，以下的设定项目被表示。

<table>
    <thead>
        <tr>
            <th>设定项目</th><th>说明</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Gadget URL</td>
            <td>
                指定Gadget文件URL。<br>
                URL最大可输入1022字节<br>
                单击[获取标题信息]按钮的话，从指定了的URL的Gadget文件取得标题和链接，设定菜单链接设定的[标题]和[标题链接]。
            </td>
        </tr>
    </tbody>
</table>


#### 7.3.3 博客的零部件

博客的零部件小工具是表示被发布的博客的零部件的小工具。
在小工具的种类处选择[__博客的零部件__]的话，以下的设定项目被表示。

<table>
    <thead>
        <tr>
            <th>设定项目</th><th>说明</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>HTML 源代码</td>
            <td>
                设定表示在博客的零部件小工具上的博客的零部件内容(HTML的断片)。
            </td>
        </tr>
    </tbody>
</table>


### 7.4 公开设定

菜单可以根据登录用户的组织和职位等角色信息来设定表示或非表示。

* 公开:对全部的用户公开菜单。
* 非公开(不选公开)：只对设定了权限的用户公开菜单。

各主体者通过设定被HTTP头域的值匹配。

这个设定方法请参照<a href="../installation-guide/customizing-web-application-module.md#http-header">安装指南 / 定义HTTP头域作为角色信息</a>。
为访问控制中心的设定指定正则表达式。正则表达式是被指定了的主体者对符合的头值判定，有效的话，被准许参照。
当复数个访问控制中心被指定的时候，全部的和演算被判定。


### 7.5 警报设定

新菜单被追加的时候，在用户画面上表示新菜单被追加的消息显示如下：
关于警报的举动可以选择如下。

* 没有警报
* 表示消息
* 强制性配置小工具(只有在小工具被设定的场合)

外部菜单服务被设定的菜单的警报设定，在外部菜单服务被读入的菜单设定里面作为alert属性没指定的菜单项目被追加了的动作的设定被使用。


### 7.6 已拖放的小工具的更新

当在菜单管理界面已经变更菜单的小工具设定，且在该菜单中被设置的小工具被拖放至个性化领域时，该属性的变更可以反映在用户界面中。
可以更新的属性是标题/标题链接,每个小工具的用户设定值(UserPref)。在更新对象的复选框里面选择的话，「适应变更」执行时被反映到用户界面。
标题以及不是datatype="hidden"的用户设定值被强制更新时候，通知的信息被表示在用户界面。


## 8 菜单项目的删除

在各个菜单的右击菜单选择[__删除__]的话，菜单删除对话框被表示。
点击[OK]按钮的话，菜单项目被删除。


<a name="set_admin"></a>
## 9 对菜单树设定管理员

在管理员项目，编辑模式时或者追加菜单树时，可以设定能够对那个菜单树编辑许可的用户。只有根菜单的编辑时管理者设定项目被表示。

* 组合框里面有「菜单树」权限的用户ID全部被表示。
* 菜单树管理者自身作为管理者只能参照·编辑被分配的菜单树。


<a name="specify_external_service"></a>
## 10 指定外部服务

本产品菜单的一部分可以进行外部服务化。
**注意** 外部服务化的菜单的场合，URL重写逻辑不被执行。
菜单构成服务，用以下的表的XML作为应答返回REST的服务创建。

_菜单设定文件表_

```
<!ELEMENT sites         (site-top*)>
<!ELEMENT site-top      (site*)>
<!ATTLIST site-top      id          #CDATA      #REQUIRED
                        title       #CDATA      #REQUIRED
                        href        #CDATA      #IMPLIED
>
<!ELEMENT site          (properties, site*)>
<!ATTLIST site          id          #CDATA      #REQUIRED
                        title       #CDATA      #REQUIRED
                        display     #CDATA      #REQUIRED
                        href        #CDATA      #IMPLIED
                        type        #CDATA      #IMPLIED
>
<!ELEMENT properties    (property*)>
<!ELEMENT property      (#PCDATA)>
<!ATTLIST property      name        #CDATA      #REQUIRED>
```

sites要素作为根要素的时候，能够用一个服务包含复数的菜单树。同时，用一个服务定义一个菜单树时候，能够以site-top为根要素省略sites要素。以下说明一下各个设定项目。

<table>
    <thead>
        <tr>
            <th>设定项目</th><th>说明</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
                <b>sites要素</b>
            </td>
            <td>
                <b>是菜单设定文件的根要素。用一个服务定义复数的菜单树的时sites要素里包含site-top要素。</b>
            </td>
        </tr>
        <tr>
            <td>site-top要素</td>
            <td>
                参照以下的site-top要素的说明。
            </td>
        </tr>
        <tr>
            <td>
                <b>site-top要素</b>
            </td>
            <td>
                <b>指定一个菜单树信息。</b>
            </td>
        </tr>
        <tr>
            <td>id属性</td>
            <td>
                被内部使用的ID。有必要指定和其他菜单项目的ID不重复的值。<br>
                <strong>注意</strong> 在菜单管理被设定的菜单项目以及其他的外部服务中被定义的菜单项目的id 要一致。
            </td>
        </tr>
        <tr>
            <td>title属性</td>
            <td>
                被菜单表示的标题。
            </td>
        </tr>
        <tr>
            <td>href属性</td>
            <td>
                指定菜单关联的链接目标的URL。
            </td>
        </tr>
        <tr>
            <td>site要素</td>
            <td>
                参照以下的site要素的说明。
            </td>
        </tr>
        <tr>
            <td>
                <b>site要素</b>
            </td>
            <td>
                <b>指定菜单项目的信息。</b>
            </td>
        </tr>
        <tr>
            <td>id属性</td>
            <td>
                被内部使用的ID。有必要指定和其他菜单项目的ID不重复的值。<br>
                <b>注意</b> 在菜单管理被设定的菜单项目以及其他的外部服务中被定义的菜单项目的id 要一致。<br>
                <b>注意</b> id的最大为256字节。超过256字节时菜单被表示，但是小工具图标为非表示。
            </td>
        </tr>
        <tr>
            <td>title属性</td>
            <td>
                菜单表示的标题。
            </td>
        </tr>
        <tr>
            <td>href属性</td>
            <td>
                指定菜单关联的链接目标的URL。
            </td>
        </tr>
        <tr>
            <td>type属性</td>
            <td>
                指定作为小工具可以拖放时指定小工具的种类。<br>
                现在能够指定种类如下。
                <ul>
                    <li>RSS阅读器</li>
                    <li>复合RSS阅读器</li>
                    <li>迷你浏览器</li>
                    <li>Gadget</li>
                    <li>不指定</li>
                <ul>
            </td>
        </tr>
        <tr>
            <td>
                <b>property要素</b>
            </td>
            <td>
                <b>指定小工具固有的属性。</b>
            </td>
        </tr>
        <tr>
            <td>site要素</td>
            <td>
                能递归定义菜单的层次结构。
            </td>
        <tr>
        <tr>
            <td>property要素</td>
            <td>
                指定RSS阅读器或者复合RSS阅读器表示的RSS的信息(URL)。
            </td>
        </tr>
        <tr>
            <td>name属性</td>
            <td>
                指定和RSS信息映射键。现在指定"url"。<br>
                <b>注意</b> URL的长度在type里选择“Gadget”时候最大1022个字节。指定其他的type时候，不限定。
            </td>
        </tr>
    </tbody>
</table>

以下是例子。

_菜单设定文件 描述例子_

```
<site-top id="nikkeiBP" title="日経BP" href="http://nikkeibp.jp/">
    <site id="nikkeiBP_all" title="統合" href="http://nikkeibp.jp/"
            type="MultiRssReader">
        <properties>
            <property name="url">http://nikkeibp.jp/index.rdf</property>
        </properties>
    </site>
    <site id="nikkeiBP_news" title="ニュース"
            href="http://nikkeibp.jp/" type="MultiRssReader">
        <properties>
            <property name="url">http://nikkeibp.jp/jp/flash/index.rdf</property>
        </properties>
        <site id="nikkeiBP_management2" title="企業・経営面"
                href="http://nikkeibp.jp/jp/business/" type="MultiRssReader">
            <properties>
                <property name="url">http://nikkeibp.jp/jp/business/index.rdf</property>
            </properties>
        </site>
        <site id="nikkeiBP_itPc" title="IT/PC面"
                href="http://nikkeibp.jp/jp/it/" type="MultiRssReader">
            <properties>
                <property name="url">http://nikkeibp.jp/jp/it/index.rdf</property>
            </properties>
        </site>
    </site>
</site-top>
```


[Properties Settings]: properties-settings.md
